#!/usr/bin/env bash
set -euo pipefail

# launcher for Package Installer CLI (macOS)
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Find node in PATH
NODE="$(command -v node || true)"
if [ -z "$NODE" ]; then
	echo "Error: Node.js is required but not found in PATH." >&2
	echo "Install Node.js with Homebrew: brew install node" >&2
	echo "Or visit https://nodejs.org/ to download and install." >&2
	exit 2
fi

# Check Node.js major version (warn if older than recommended)
NODE_VER_RAW="$($NODE -v 2>/dev/null || true)"
if [[ $NODE_VER_RAW =~ ^v([0-9]+) ]]; then
	NODE_MAJOR=${BASH_REMATCH[1]}
	if [ "$NODE_MAJOR" -lt 22 ]; then
		echo "Warning: Detected Node.js $NODE_VER_RAW â€” recommended >= 22. Continuing anyway..." >&2
	fi
fi

exec "$NODE" "$DIR/cli-with-packages.js" "$@"
